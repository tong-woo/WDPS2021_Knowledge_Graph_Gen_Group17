<!DOCTYPE html>
<html>
  <head>
    <title>Knowledge Graph Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="" />
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <link href="/stylesheets/bootstrap.css" rel='stylesheet' type='text/css' />
    <!-- Custom Theme files -->
    <link href="/stylesheets/style.css" rel='stylesheet' type='text/css' />
    <script src="/javascripts/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap.js"></script>	
    <!--web-fonts-->
    <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Cabin:400,700,500,600' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Pacifico|Prata' rel='stylesheet' type='text/css'>
    <!--//web-fonts-->
      <!--search jQuery-->
      <script src="/javascripts/main.js"></script>
      <!--//search jQuery-->
      <!-- animation-effect -->
    <link href="/stylesheets/animate.min.css" rel="stylesheet"> 
    <script src="/javascripts/wow.min.js"></script>
    <script>
    new WOW().init();
    </script>
    <script src="https://kit.fontawesome.com/43dcc20e7a.js" crossorigin="anonymous"></script>
    <!-- //animation-effect -->

  </head>
  <body>

    <div class="banner-1 agileinfo-2" style="min-height: 100px;">
      <div class="container">
        <div class="header"><!--header-->	
          <nav class="navbar navbar-default">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <h1><a href="/">Generic Knowledge Graph Generator</a></h1>
            </div>
            <!--navbar-header-->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="/">Home</a></li>
                <li><a href="/query" class="active">Query</a></li>
              </ul>	
              <div class="clearfix"> </div>	
            </div>
          </nav>
      </div>
      
      
      </div>
    </div>

    <div class="visualization-container" style="width: 100%; padding: 64px;">

      <h5 style="margin-bottom:32px;"><a href="/query"> Back to books </a></h5>

      <h1 style="margin-bottom:8px;">Book: <%= bookId %></h1>
      <h2 style="margin-bottom:8px;"><%= numEntities %> characters </h2>
      <h2 style="margin-bottom:32px;"><%= numRelationships %> relationships between characters </h2>

      <h4 style="margin-bottom:16px;"> Search for characters:</h4>

      <div class="search-box">
          <input type="text" class="search-input" placeholder="Search...">
          <button class="search-button">
            <i class="fas fa-search"></i>
          </button>
      </div>

      <ul id="search-results" style="margin-left: 32px; margin-top: 16px;">
      </ul>

      <div class="book" style="opacity: 0; margin-top: 16px; margin-left: 8px;">
        <div class="book__pg-shadow"></div>
        <div class="book__pg"></div>
        <div class="book__pg book__pg--2"></div>
        <div class="book__pg book__pg--3"></div>
        <div class="book__pg book__pg--4"></div>
        <div class="book__pg book__pg--5"></div>
      </div>

    </div>

  <script type="text/javascript">
    $('.search-button').click(() => {
      $('#search-results').empty();
      $('.book').css('opacity', 1);
      let bookId = "<%= bookId %>";
      console.log(bookId);
      let searchQ = $('.search-input').val();
      console.log(searchQ);
      $.get( "/query/search", {
        q: searchQ,
        bookId
      }, ( data ) => {
        $('.book').css('opacity', 0);
        let entities = data.response;
        $('#search-results').append(`
          ${entities.map((entity) => {
            return `
                <li>
                  <div> 
                    <a style="text-decoration:underline;" href="/query/entity/?bookId=${bookId}&entityId=${entity.properties.pid.low}"> ${entity.properties.name}</a> 
                  </div>
                </li>
              `
          }).join(' ')}
        `);
      });
    })

  </script>
  </body>
</html>

